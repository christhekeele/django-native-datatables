// Generated by CoffeeScript 1.3.1
(function() {

  $(document).ready(function() {
    var $datatable, $filter, datatable, filter, filter_name, paginate, search, table_name, tables, update_table, _i, _j, _k, _l, _len, _len1, _len2, _len3, _ref, _ref1, _ref2;
    tables = $('div:data("table")');
    for (_i = 0, _len = tables.length; _i < _len; _i++) {
      datatable = tables[_i];
      $datatable = $(datatable);
      table_name = $(tables).length > 1 ? 'table' : $datatable.data("table");
      window[table_name] = $datatable.data("table-state");
      _ref = $datatable.find(':data("table-filter")');
      for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
        filter = _ref[_j];
        $filter = $(filter);
        filter_name = $filter.data('table-filter');
        $filter.find(':data("filter")').live('click', function() {
          return update_table(table_name, 'filter', filter_name, $(this).data('filter'));
        });
      }
      _ref1 = $datatable.find(':data("table-search")');
      for (_k = 0, _len2 = _ref1.length; _k < _len2; _k++) {
        search = _ref1[_k];
        $(search).find(':data("search")').live('keyup', function() {
          return update_table(table_name, 'search', false, $(search).find(':data("search")').val());
        });
      }
      _ref2 = $datatable.find(':data("table-paginate")');
      for (_l = 0, _len3 = _ref2.length; _l < _len3; _l++) {
        paginate = _ref2[_l];
        $(paginate).find(':data("per_page")').live('click', function() {
          return update_table(table_name, 'per_page', false, $(this).data('per_page'));
        });
        $(paginate).find(':data("page")').live('click', function() {
          return update_table(table_name, 'page', false, $(this).data('page'));
        });
      }
    }
    return update_table = function(table_name, action, target, value) {
      console.log(table_name, action, target, value);
      if (action === 'search') {
        window[table_name].search_param = value;
        window[table_name].page_number = 1;
      }
      if (action === 'filter') {
        if (window[table_name].filter_values[target]) {
          window[table_name].filter_values[target] = "";
        } else {
          window[table_name].filter_values[target] = value;
        }
        window[table_name].page_number = 1;
      }
      if (action === 'order') {
        window[table_name].ordering[target] = value;
        window[table_name].page_number = 1;
      }
      if (action === 'per_page') {
        window[table_name].per_page = value;
        window[table_name].page_number = 1;
      }
      if (action === 'page') {
        window[table_name].page_number = value;
      }
      console.log(window[table_name]);
      return $.ajax({
        url: "/company/table/",
        type: "GET",
        datatype: "html",
        contentType: "application/json",
        data: {
          datatable: JSON.stringify(window[table_name])
        },
        success: function(data) {
          var table_body, table_pages;
          table_body = $datatable.find(':data("table-content=' + table_name + '")');
          table_body.html($(data).find(':data("table-content=' + table_name + '")').children());
          table_pages = $datatable.find(':data("table-paginate=' + table_name + '")');
          return table_pages.html($(data).find(':data("table-paginate=' + table_name + '")').children());
        },
        error: function(data, status, error) {
          return console.log(error, data.responseText);
        }
      });
    };
  });

}).call(this);
